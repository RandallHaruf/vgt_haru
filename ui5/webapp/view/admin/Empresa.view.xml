<core:View
	controllerName="ui5ns.ui5.controller.admin.Empresa"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns:l="sap.ui.layout" 
	xmlns:f="sap.ui.layout.form"
	xmlns:dnd="sap.ui.core.dnd"
	xmlns:table="sap.ui.table"
	xmlns="sap.m">
	<NavContainer id="myNav" class="fixNavContainer">
		<Page
			id="paginaListagem"
			showHeader="false"
			visible="true">
			<Table
				id="tabelaObjetos"
				items="{
					path: '/objetos',
					sorter: [{
						path: 'nome'
					}, {
						path: 'pais'
					}, {
						path: 'status'
					}]
				}"
				growing="true"
				enableBusyIndicator="true"
				growingScrollToLoad="true"
				updateFinished="onTerminouAtualizar">
		
				<headerToolbar>
					<Toolbar>
						<Title 
							id="cabecalhoTabelaObjetos" 
							text="{i18n>viewGeralEmpresas}"/>
						<ToolbarSpacer />
						<Button 
							id="botaoNovoObjeto" 
							icon="sap-icon://add" 
							press="onNovoObjeto" 
							text="{i18n>viewGeralNovo}"
							type="Emphasized"/>
					</Toolbar>
				</headerToolbar>
		
				<columns>
					<Column>
						<Text text="{i18n>viewEmpresasNome}" />
					</Column>
					<Column>
						<Text text="{i18n>viewEmpresasPais}" />
					</Column>
					<Column>
						<Text text="Status" />
					</Column>
				</columns>
		
				<items>
					<ColumnListItem
						type="Navigation"
						press="onAbrirObjeto">
						<cells>
							<ObjectIdentifier title="{nome}"/>
							<Text text="{pais}" />
							<Text text="{status}" />
						</cells>
					</ColumnListItem>
				</items>
			</Table>
		</Page>
		<Page
			id="paginaObjeto"
			showHeader="false">
			<content>
				<VBox class="sapUiSmallMargin">
					<f:Form 
						id="formularioObjeto" 
						editable="true">
						<f:title>
			                <core:Title text="{i18n>viewGeralEmpresa}"/>
						</f:title>
						<f:layout>
							<f:ResponsiveGridLayout labelSpanXL="4" labelSpanL="4" labelSpanM="12" labelSpanS="12" adjustLabelSpan="false" emptySpanXL="0"
								emptySpanL="0" emptySpanM="0" emptySpanS="0" columnsXL="2" columnsL="2" columnsM="1" singleContainerFullSize="false"/>
						</f:layout>
					<f:formContainers>
							<f:FormContainer title="{i18n>viewEmpresasCadastro}">
								<f:formElements>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasNome}" labelFor="inputNomeEmpresa" />
										</f:label>
										<f:fields>
											<Input id="inputNomeEmpresa" value="{/objeto/nome}" required="true" />
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasNumeroHFM}" labelFor="inputHFMSAP" />
										</f:label>
										<f:fields>
											<Input id="inputHFMSAP" value="{/objeto/num_hfm_sap}" required="true" />
										</f:fields>
									</f:FormElement>
									<f:FormElement label="{i18n>viewEmpresasTINTaxIdentificationNumber}" >
										<f:fields>
											<Input id="inputTIN" value="{/objeto/tin}" change="onChangeTin"  />
										</f:fields>
									</f:FormElement>
									<f:FormElement label="{i18n>viewEmpresasJurisdicaoT}">
										<f:fields>
											<Input id="inputJurisdicaoTIN" value="{/objeto/jurisdicao_tin}" enabled="{= ${/objeto/tin} ?  true : false }" valueState="{/objeto/valueStateJurisdicaoTin}" change="onPreencherJurisdicaoTin" />
										</f:fields>
									</f:FormElement>
									<f:FormElement label="{i18n>viewEmpresasNITaxIdentificationNumber}">
										<f:fields>
											<Input id="inputNI" value="{/objeto/ni}"  change="onChangeNi"  />
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasJurisdicaoN}" labelFor="inputJurisdicaoNI"  />
										</f:label>
										<f:fields>
											<Input id="inputJurisdicaoNI" value="{/objeto/jurisdicao_ni}"  enabled="{= ${/objeto/ni} ?  true : false }" valueState="{/objeto/valueStateJurisdicaoNi}" change="onPreencherJurisdicaoNi" />
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasEndereco}" labelFor="inputEndereco" />
										</f:label>
										<f:fields>
											<Input id="inputEndereco" value="{/objeto/endereco}" required="true" />
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasPais}" labelFor="comboboxPais" />
										</f:label>
										<f:fields>
											<ComboBox id="comboboxPais" items="{/Pais}" selectedKey="{/objeto/fk_pais.id_pais}" enabled="{= !${/isUpdate}}" required="true" selectionChange="onSelectChange">
												<core:Item text="{nomePais}" key="{id}"/>
											</ComboBox>
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewDetalhesDaEmpresaVinculadaTipoSocietario}" class="sapMLabelRequired" />
										</f:label>
										<f:fields>
											<Select 
												id="selectTipoSocietario" 
												items="{/DominioEmpresaTipoSocietario}" 
												selectedKey="{/objeto/fk_dominio_empresa_tipo_societario.id_dominio_empresa_tipo_societario}">
												<core:Item text="{tipo_societario}" key="{id_dominio_empresa_tipo_societario}" />
											</Select>
										</f:fields>
									</f:FormElement>
								<f:FormElement>
										<f:label>
											<Label text="{i18n>viewRelatorioAnoFiscal}" />
										</f:label>
										<f:fields>
											<DatePicker 
												id="datepickerStartDate" 
												placeholder="{i18n>viewGeralInsiraUmaData}" 
												valueFormat="yyyy-MM-dd" 
												value="{/objeto/fy_start_date}" 
												required="true"
												change="onTrocarData" />
											<DatePicker 
												id="datepickerEndDate" 
												placeholder="{i18n>viewGeralInsiraUmaData}" 
												valueFormat="yyyy-MM-dd" 
												value="{/objeto/fy_end_date}"
												required="true"
												change="onTrocarData" />
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasStatusDaEmpresa}" labelFor="selectStatus" class="sapMLabelRequired" />
										</f:label>
										<f:fields>
											<Select id="selectStatus" items="{/DominioEmpresaStatus}" selectedKey="{/objeto/fk_dominio_empresa_status.id_dominio_empresa_status}">
												<core:Item text="{status}" key="{id_dominio_empresa_status}" />
											</Select>
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="{i18n>viewEmpresasAliquotaVigente}" labelFor="selectAliquota" />
										</f:label>
										<f:fields>
											<Select id="selectAliquota" items="{/Aliquota}" selectedKey="{/objeto/fk_aliquota.id_aliquota}">
												<core:Item text="{nome} - {valor}%" key="{id_aliquota}" />
											</Select>
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="LBC {i18n>viewEmpresasNome}" labelFor="inputLBCResponsavel" />
										</f:label>
										<f:fields>
											<Input id="inputLBCResponsavel" value="{/objeto/lbc_nome}" required="true" />
										</f:fields>
									</f:FormElement>
									<f:FormElement>
										<f:label>
											<Label text="LBC Email" labelFor="inputLBCEmail" />
										</f:label>
										<f:fields>
											<Input id="inputLBCEmail" type="Email" value="{/objeto/lbc_email}" required="true" change="onTrocarEmail" />
										</f:fields>
									</f:FormElement>
									<f:FormElement label="{i18n>viewEmpresasComentarios}">
										<f:fields>
											<TextArea 
												id="textAreaComentarios" 
												rows="5" value="{/objeto/comentarios}"/>
										</f:fields>
									</f:FormElement>
								</f:formElements>
							</f:FormContainer>
						</f:formContainers>
					</f:Form>
					<f:Form 
						id="formularioVinculoObrigacoes"
						editable="true">
						<f:title>
							<core:Title text="{i18n>viewEmpresasObrigacoesAcessorias}"  />
						</f:title>
						<f:layout>
							<f:ResponsiveGridLayout labelSpanXL="4" labelSpanL="4" labelSpanM="12" labelSpanS="12" adjustLabelSpan="false" emptySpanXL="0"
								emptySpanL="0" emptySpanM="0" emptySpanS="0" columnsXL="2" columnsL="2" columnsM="1" singleContainerFullSize="true"/>
						</f:layout>
						<f:formContainers>
							<f:FormContainer>
								<f:FormElement>
									<!--<table:Table rows="{/ObrigacaoAcessoria}" id="tableObrigacoes" selectionMode="None">-->
									<table:Table rows="{/ModeloObrigacao}" id="tableObrigacoes" selectionMode="None">
										<table:extension>
											<Toolbar>
												<ToolbarSpacer/>
												<SearchField 
													id="searchObrigacoes"
													width="15rem" 
													search="onTextSearch" 
													value="{/filterValue}" />
											</Toolbar>
										</table:extension>
										<table:columns>
											<table:Column width="45px">
												<table:template>
													<CheckBox selected="{selecionada}" />
												</table:template>
											</table:Column>
											<table:Column>
												<Label text="{i18n>viewEmpresasTipo}" />
												<table:template>
													<Text text="{tblTipoObrigacao.tipo}" />
												</table:template>
											</table:Column>
											<table:Column>
												<Label text="{i18n>viewEmpresasNome}" />
												<table:template>
													<Text text="{tblModeloObrigacao.nome_obrigacao}" />
												</table:template>
											</table:Column>
											<table:Column>
												<Label text="{i18n>viewEmpresaDataPrazo}" />
												<table:template>
													<Text text="{tblModeloObrigacao.prazo_entrega}" />
												</table:template>
											</table:Column>
											<table:Column>
												<Label text="{i18n>viewEmpresaDataCustomizada}" />
												<table:template>
													<DatePicker valueFormat='yyyy-MM-dd' value="{data_selecionada}" editable="{= !!${selecionada} === true ? true : false }" />
												</table:template>
											</table:Column>											
										</table:columns>
									</table:Table>
								</f:FormElement>
							</f:FormContainer>
						</f:formContainers>
					</f:Form>
					<Panel headerText="{i18n>viewEmpresasHistoricoObrigacoes}" expandable="true" class="sapUiNoContentPadding" visible="false">
						<content>
							<!--<f:Form editable="true" visible="{/showHistorico}">-->
							<f:Form editable="true" visible="false">
								<!--<f:title>
									<core:Title text="Histórico de Obrigações" />
								</f:title>-->
								<f:layout>
									<f:ResponsiveGridLayout labelSpanXL="4" labelSpanL="4" labelSpanM="12" labelSpanS="12" adjustLabelSpan="false" emptySpanXL="0"
										emptySpanL="0" emptySpanM="0" emptySpanS="0" columnsXL="2" columnsL="2" columnsM="1" singleContainerFullSize="true"/>
								</f:layout>
								<f:formContainers>
									<f:FormContainer>
										<f:formElements>
											<f:FormElement>
												<f:fields>
													<ScrollContainer
														horizontal="true"
														vertical="true"
														width="100%"
														height="400px">
														<Table 
															items="{
																path: '/objeto/historicoObrigacoes',
																sorter: [{
																	path: 'tipo'
																}, {
																	path: 'nome'
																}]
															}"
															sticky="ColumnHeaders">
															<columns>
																<Column>
																	<Text text="{i18n>viewEmpresasTipo}" />
																</Column>
																<Column>
																	<Text text="{i18n>viewEmpresasNome}" />
																</Column>
																<Column>
																	<Text text="{i18n>viewEmpresasDataI}" />
																</Column>
																<Column>
																	<Text text="{i18n>viewEmpresasDataF}" />
																</Column>
															</columns>
															<items>
																<ColumnListItem>
																	<cells>
																		<Text text="{tipo}" />
																		<Text text="{nome}" />
																		<DatePicker valueFormat='yyyy-MM-dd' value="{data_inicio_rel}" editable="false" />
																		<DatePicker valueFormat='yyyy-MM-dd' value="{data_fim_rel}" editable="false" />
																	</cells>
																</ColumnListItem>
															</items>
														</Table>
													</ScrollContainer>
												</f:fields>
											</f:FormElement>
										</f:formElements>
									</f:FormContainer>
								</f:formContainers>
							</f:Form>
						</content>
					</Panel>
					<Panel headerText="{i18n>viewEmpresasHistoricoAliquotas}" expandable="true" class="sapUiNoContentPadding" visible="{= ${/showHistorico}}">
						<content>
							<f:Form editable="true" >
								<!--<f:title>
									<core:Title text="Histórico de Alíquotas" />
								</f:title>-->
								<f:layout>
									<f:ResponsiveGridLayout labelSpanXL="4" labelSpanL="4" labelSpanM="12" labelSpanS="12" adjustLabelSpan="false" emptySpanXL="0"
										emptySpanL="0" emptySpanM="0" emptySpanS="0" columnsXL="2" columnsL="2" columnsM="1" singleContainerFullSize="true"/>
								</f:layout>
								<f:formContainers>
									<f:FormContainer>
										<f:formElements>
											<f:FormElement>
												<f:fields>
													<ScrollContainer
														horizontal="true"
														vertical="true"
														width="100%"
														height="400px">
														<Table 
															items="{/objeto/historicoAliquotas}" 
															sticky="ColumnHeaders">
															<columns>
																<Column vAlign="Middle">
																	<Text text="{i18n>viewEmpresasNome}" />
																</Column>
																<Column>
																	<Text text="{i18n>viewEmpresasDataI}" />
																</Column>
																<Column>
																	<Text text="{i18n>viewEmpresasDataF}" />
																</Column>
															</columns>
															<items>
																<ColumnListItem>
																	<cells>
																		<ObjectIdentifier title="{nome}" />
																		<DatePicker valueFormat="yyyy-MM-dd" value="{data_inicio_rel}" editable="false" />
																		<DatePicker valueFormat="yyyy-MM-dd" value="{data_fim_rel}" editable="false" />
																	</cells>
																</ColumnListItem>
															</items>
														</Table>
													</ScrollContainer>
												</f:fields>
											</f:FormElement>
										</f:formElements>
									</f:FormContainer>
								</f:formContainers>
							</f:Form>
						</content>
					</Panel>
				</VBox>
			</content>
			<footer>
				<Toolbar>
					<ToolbarSpacer/>
					<Button 
						id="btnSalvar"
						text="{i18n>viewGeralSalvar}" 
						type="Accept" 
						press="onSalvar"/>
					<Button 
						text="{i18n>viewGeralCancelar}" 
						type="Reject" 
						press="onCancelar"/>
				</Toolbar>
			</footer>
		</Page>
	</NavContainer>
</core:View>